---
import { getCollection } from 'astro:content'
import SiteLayout from '@/layouts/SiteLayout.astro'
import BentoBox from '@/layouts/BentoBox.astro'
import { db, PageMetrics } from 'astro:db'
import { eq } from 'astro:db'

export const prerender = true

// =====================================
// Home Page
// =====================================

const blog = await getCollection('blog')
const posts = blog.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)

const featured = posts.at(0)!
const metrics = await db.select().from(PageMetrics).where(eq(PageMetrics.route, '/'))

const feed = posts.slice(1).map(({ data, id }) => ({
  name: data.title,
  date: data.updatedDate ?? data.pubDate,
  href: `/blog/${id}`,
}))

console.log({ metrics })
---

<SiteLayout
  title="Home"
  className="justify-center grow"
  transition:animate="none"
>
  <BentoBox className="lg:max-w-7xl" featured={featured} feed={feed} />
</SiteLayout>
