---
import { getCollection } from 'astro:content'
import SiteLayout from '@/layouts/SiteLayout.astro'
import BentoBox from '@/layouts/BentoBox.astro'

export const prerender = false

// =====================================
// Home Page
// =====================================

const blog = await getCollection('blog')
const posts = blog.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)

const featured = posts.at(0)!

const feed = posts.slice(1).map(({ data, id }) => ({
  name: data.title,
  date: data.updatedDate ?? data.pubDate,
  href: `/blog/${id}`,
}))
---

<SiteLayout
  title="Home"
  className="justify-center grow"
  transition:animate="none"
  htmx
>
  <BentoBox className="lg:max-w-7xl" featured={featured} feed={feed} />
  <div class="pb-4">
    <page-metrics
      views="0"
      likes="0"
      hx-swap="outerHTML"
      hx-trigger="load"
      hx-post="/api/metrics"></page-metrics>
  </div>
</SiteLayout>
<script>
  import { PageMetrics } from '@/components/web/PageMetrics'

  PageMetrics.register()
</script>
