---
import { fetchDailyReport } from '@/lib/server/fetch-daily-report'
import SiteLayout from '@/layouts/SiteLayout.astro'
import { marked } from 'marked'

const DEFAULT_LIMIT = 300
const url = new URL(Astro.url)

const limit = Number(url.searchParams.get('limit') ?? DEFAULT_LIMIT)
const refreshStr = url.searchParams.get('refresh')
const refresh = refreshStr === 'true' || Number(refreshStr) > 0

const report = await fetchDailyReport({ limit, refresh })
const content = marked(report.summary)
---

<SiteLayout>
  <article class="flex flex-col max-w-3xl gap-y-4 mx-auto px-4 py-16" set:html={content} />
</SiteLayout>

<style is:global>
  @import 'tailwindcss';
  h1 {
    @apply text-6xl font-black tracking-tight pb-4;
  }
  h2 {
    @apply text-3xl font-bold;
  }
  h3 {
    @apply text-2xl font-bold;
  }
  h4 {
    @apply text-xl font-bold;
  }
</style>
