---
import BaseHead from '@/components/astro/BaseHead.astro'

export const prerender = false
---

<!doctype html>
<html lang="en" class="h-full bg-gray-800">
  <head>
    <BaseHead title={'Code'} description={'a simple online code playground.'} />
    <style>
      html,
      head {
        background-color: oklch(27.8% 0.033 256.848) !important;
      }
    </style>
  </head>
  <body class="text-gray-100 h-full max-h-screen overscroll-contain m-0 flex flex-col">
    <!-- Toolbar -->
    <div class="bg-neutral-800 flex items-center gap-3 top-0 left-0 right-0">
      <span class="text-sm font-mono text-neutral-400 px-4 py-3">TypeScript</span>
      <span id="ts-version" class="text-xs font-mono text-neutral-600"></span>
      <button id="run-btn" class="ml-auto px-6 py-3 text-sm bg-blue-500 text-white hover:bg-blue-600"> Run </button>
    </div>

      <!-- Editor -->
      <div id="editor" class="flex-1"></div>

      <!-- Output -->
      <div id="output" class="bg-gray-800 border-t bottom-0 left-0 right-0 border-gray-700 p-3">
        <div class="text-xs text-gray-400 mb-1">Output:</div>
        <pre id="output-text" class="text-sm font-mono text-green-400"></pre>
      </div>

    <script is:inline src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
    <script is:inline src="https://unpkg.com/typescript@latest/lib/typescript.js"></script>
    <script is:inline defer>
      require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@latest/min/vs' } })

      require(['vs/editor/editor.main'], function () {
        const editor = monaco.editor.create(document.getElementById('editor'), {
          value: `\n\nconst greeting: string = "Hello, TypeScript!"\nconsole.log(greeting)\n\nfunction add(a: number, b: number): number {\n  return a + b\n}\n\nconsole.log(add(2, 3))`,
          language: 'typescript',
          theme: 'vs-dark',
          automaticLayout: true,
        })

        document.getElementById('run-btn').addEventListener('click', () => {
          const code = editor.getValue()
          const output = document.getElementById('output')
          const outputText = document.getElementById('output-text')

          const logs = []
          const originalLog = console.log
          console.log = (...args) => {
            logs.push(args.join(' '))
            originalLog(...args)
          }

          try {
            document.getElementById('ts-version').innerText = 'ES2022'
            // Transpile TypeScript to JavaScript
            const result = ts.transpileModule(code, {
              compilerOptions: {
                module: ts.ModuleKind.Module,
                target: ts.ScriptTarget.ES2022,
              },
            })

            // Execute the transpiled JavaScript
            eval(result.outputText)
            outputText.textContent = logs.join('\n') || '(no output)'
          } catch (err) {
            outputText.textContent = 'Error: ' + err.message
          }

          console.log = originalLog
          output.classList.remove('hidden')
        })
      })
    </script>
  </body>
</html>

<style>
  html,
  body {
    height: 100%;
    margin: 0;
  }
</style>
