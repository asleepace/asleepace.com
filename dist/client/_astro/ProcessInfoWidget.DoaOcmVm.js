import{j as s,c as T}from"./clsx.Bq1LokoP.js";import{r as t}from"./index.BVOCwoKb.js";async function y(){return fetch("/api/system/info",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).catch(e=>{throw console.error("[fetchProcessInfo] failed",e),e})}function x(e=[],r,c){if(!r||!e)return e;console.log("[DataTable] sorting by",`"${String(r)}"`,c?"ascending":"descending");const l=e.toSorted((f,o)=>{const n=f[r],a=o[r];if(n&&a&&isNaN(+n)&&isNaN(+a))return c?String(n).localeCompare(String(a)):String(a).localeCompare(String(n));{const i=Number(n)-Number(a);return c?i:-i}});return console.log("[DataTable] sorted:",l.length),l}function P(e,r,c=!0){const[l,f]=t.useTransition(),[o,n]=t.useState(e),a=t.useMemo(()=>o&&o.length?o:x(e,r,c),[e,r,c]),i=t.useCallback(()=>{f(()=>{const d=x(e,r,c);n(d)})},[e,r,c]);return t.useEffect(()=>{e?.length&&i()},[e?.length]),[o.length?o:a,l]}function k({data:e=[],getKey:r,sortBy:c}){const l=t.useMemo(()=>!e||!e.length?[]:Object.keys(e[0]),[e]),f=t.useRef(null),o=t.useRef(null),[n,a]=t.useState(!1),[i,d]=t.useState(c),[m,R]=P(e,i,n),[j,S]=t.useState(0),p=t.useCallback(u=>{d(u),a(!n),S(l.indexOf(String(u))),o.current?.scrollTo({top:0,behavior:"smooth"})},[i,n,l,o]),C=t.useCallback(()=>{const u=String(i)+(n?"asc":"desc");return s.jsx(t.Fragment,{children:s.jsx("tbody",{ref:f,children:m.map((h,D)=>{const b=`row:${r(h)}:${D}`,I=Object.values(h).map((N,v)=>{const g=String(N);return s.jsx(t.Fragment,{children:s.jsx("td",{title:g,"aria-label":g,children:g})},`${b}:col:${v}`)});return s.jsx(t.Fragment,{children:s.jsx("tr",{children:I})},b)})})},u)},[r,n,i,m]);return s.jsx("div",{ref:o,className:"data-table-container scrollbar-none",children:s.jsxs("table",{className:"data-table",children:[s.jsx("thead",{children:s.jsx("tr",{children:l.map((u,h)=>s.jsx("th",{className:T("font-bold hover:bg-indigo-500",h===j&&"bg-indigo-500"),children:s.jsx("strong",{onClick:()=>p(u),children:u})},u))})}),s.jsx(C,{})]})})}const E=t.memo(k),$=({PID:e})=>e.toString();function w({refreshInterval:e}){const[r,c]=t.useState([]),[l,f]=t.useState();return t.useEffect(()=>{const o=()=>y().then(c).catch(a=>{console.error(a),f(a)});o();const n=setInterval(()=>{o()},e??5e3);return()=>clearInterval(n)},[e]),l?s.jsx("div",{className:"text-red-500",children:l}):s.jsx(E,{sortBy:"PID",getKey:$,data:r})}export{w as ProcessInfoWidget};
