import{j as s}from"./jsx-runtime.D_zvdyIk.js";import{r as t}from"./index.Dy6lLLXr.js";import{c as T}from"./clsx.B-dksMZM.js";async function y(){return fetch("/api/system/info",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).catch(e=>{throw console.error("[fetchProcessInfo] failed",e),e})}function g(e=[],o,c=!0){return!o||!e?e:(console.log("[DataTable] Sorting data",e,o,c),[...e].toSorted((a,u)=>{const n=a[o],r=u[o];if(n&&r&&isNaN(+n)&&isNaN(+r))return c?String(n).localeCompare(String(r)):String(r).localeCompare(String(n));{const l=Number(n)-Number(r);return c?l:-l}}))}function P(e,o,c=!0){const[a,u]=t.useTransition(),[n,r]=t.useState(e),l=t.useMemo(()=>n&&n.length?n:g(e,o,c),[e,o,c]),f=t.useCallback(()=>{const d=g(e,o,c);u(()=>{r(d)})},[e,o,c]);return t.useEffect(()=>{e?.length&&f()},[f]),[n.length?n:l,a]}function k({data:e=[],getKey:o,sortBy:c}){const a=t.useMemo(()=>!e||!e.length?[]:Object.keys(e[0]),[e]),u=t.useRef(null),n=t.useRef(null),[r,l]=t.useState(!1),[f,d]=t.useState(c),[b,$]=P(e,f,r),[j,S]=t.useState(0),p=t.useCallback(i=>{d(i),l(!r),S(a.indexOf(String(i))),n.current?.scrollTo({top:0,behavior:"smooth"})},[f,r,a,n]),C=t.useCallback(()=>{const i=String(f)+(r?"asc":"desc");return s.jsx(t.Fragment,{children:s.jsx("tbody",{ref:u,children:b.map((h,D)=>{const x=`row:${o(h)}:${D}`,I=Object.values(h).map((N,v)=>{const m=String(N);return s.jsx(t.Fragment,{children:s.jsx("td",{title:m,"aria-label":m,children:m})},`${x}:col:${v}`)});return s.jsx(t.Fragment,{children:s.jsx("tr",{children:I})},x)})})},i)},[o,r,f,b]);return s.jsx("div",{ref:n,className:"data-table-container scrollbar-none",children:s.jsxs("table",{className:"data-table",children:[s.jsx("thead",{children:s.jsx("tr",{children:a.map((i,h)=>s.jsx("th",{className:T("font-bold hover:bg-indigo-500",h===j&&"bg-indigo-500"),children:s.jsx("strong",{onClick:()=>p(i),children:i})},i))})}),s.jsx(C,{})]})})}const E=t.memo(k),R=({PID:e})=>e.toString();function K({refreshInterval:e}){const[o,c]=t.useState([]),[a,u]=t.useState();return t.useEffect(()=>{const n=()=>y().then(c).catch(l=>{console.error(l),u(l)});n();const r=setInterval(()=>{n()},e??5e3);return()=>clearInterval(r)},[e]),a?s.jsx("div",{className:"text-red-500",children:a}):s.jsx(E,{sortBy:"PID",getKey:R,data:o})}export{K as ProcessInfoWidget};
